# 发布行为说明

## 发布方式

插件现在支持两种发布方式：

### 方式 1：在当前小红书页面发布（推荐）

**前提条件：**
- 你已经打开了小红书创建页面
- 页面 URL 为 `https://www.xiaohongshu.com/creation`

**行为：**
- 插件会在当前页面上填写标题、文案
- 点击发布按钮
- 完成发布

**优点：**
- 不需要打开新标签页
- 可以实时监控发布过程
- 更快速

### 方式 2：自动打开创建页面发布

**前提条件：**
- 没有打开小红书创建页面

**行为：**
- 插件会自动打开小红书创建页面
- 在新页面上填写标题、文案
- 点击发布按钮
- 完成发布

**优点：**
- 无需手动打开创建页面
- 完全自动化

---

## 使用步骤

### 推荐方式（在当前页面发布）

1. **打开小红书创建页面**
   - 访问 https://www.xiaohongshu.com/creation
   - 或在小红书首页点击 "发布" 按钮

2. **打开插件**
   - 点击浏览器右上角的插件图标
   - 或按 Ctrl+Shift+Y 打开侧边栏

3. **配置飞书凭证**
   - 在 "配置" 标签中填写 App ID、App Secret、Base ID
   - 点击 "测试连接" 验证

4. **开始发布**
   - 切换到 "发布" 标签
   - 点击 "开始发布"
   - 在 "日志" 标签中查看进度

---

## 发布流程

```
开始发布
  ↓
检查飞书凭证
  ↓
从飞书读取数据
  ↓
筛选待发布内容
  ↓
对每条内容：
  ├─ 检查当前页面
  ├─ 如果是小红书页面 → 在当前页面发布
  ├─ 如果不是 → 打开创建页面
  ├─ 填写标题
  ├─ 填写文案
  ├─ 点击发布
  ├─ 等待 30 秒
  └─ 继续下一条
  ↓
发布完成
```

---

## 发布间隔

- **默认间隔**: 30 秒
- **原因**: 避免小红书服务器限流
- **可修改**: 在 background.js 中修改 `sleep(30000)` 的值

---

## 日志说明

发布过程中会显示以下日志：

- `🚀 开始从飞书读取数据...` - 开始读取
- `✅ 读取到 X 条待发布内容` - 读取成功
- `📤 [1/X] 正在发布: "标题"` - 正在发布
- `✅ 发布成功: "标题"` - 发布成功
- `❌ 发布失败: "标题" - 错误信息` - 发布失败
- `⏳ 等待 30 秒后发布下一条...` - 等待中
- `🎉 发布完成！总耗时: Xm Ys` - 全部完成

---

## 常见问题

### Q: 为什么发布失败？

**可能的原因：**
1. 小红书页面加载不完全 → 等待页面加载完成
2. 找不到输入框 → 小红书页面结构可能改变
3. 找不到发布按钮 → 小红书页面结构可能改变

**解决方案：**
- 查看浏览器控制台的错误信息
- 手动打开小红书创建页面测试
- 检查输入框和发布按钮是否存在

### Q: 可以在当前页面发布吗？

**是的！** 如果你已经打开了小红书创建页面，插件会在当前页面发布。

### Q: 发布间隔可以改吗？

**可以。** 在 background.js 中找到 `await sleep(30000);` 并修改数字（单位：毫秒）。

### Q: 发布失败后会怎样？

**插件会：**
1. 记录失败日志
2. 继续发布下一条
3. 最后显示统计信息（成功数、失败数）

---

## 技术细节

### 页面检测

插件会检查当前活跃标签页是否为小红书页面：
```javascript
const tabs = await chrome.tabs.query({ 
  url: 'https://www.xiaohongshu.com/*',
  active: true
});
```

### 元素查找

插件会尝试多种方式查找输入框和发布按钮：
- 通过 placeholder 属性
- 通过 contenteditable 属性
- 通过 class 名称
- 通过 aria-label 属性

### 事件触发

填写内容后会触发以下事件：
- `input` - 输入事件
- `change` - 改变事件
- `keydown` - 键盘事件

这样可以确保小红书能正确识别输入。

