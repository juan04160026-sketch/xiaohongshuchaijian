# 小红书自动发布助手 - Chrome 扩展安装指南

## 项目概述

这是一个 Chrome 浏览器扩展，用于从飞书多维表格自动发布内容到小红书。支持：
- 从飞书多维表格读取待发布内容
- 自动填写小红书标题、文案、图片
- 支持多条内容批量发布
- 30 秒发布间隔控制
- 实时发布监控和日志记录
- 暂停/继续/停止发布功能

## 文件结构

```
.
├── manifest.json          # 扩展配置文件
├── popup.html            # 弹窗 UI
├── popup.css             # 弹窗样式
├── popup.js              # 弹窗逻辑
├── background.js         # 后台服务 (Service Worker)
├── content.js            # 内容脚本 (在小红书页面运行)
└── images/               # 扩展图标 (可选)
    ├── icon-16.png
    ├── icon-48.png
    └── icon-128.png
```

## 安装步骤

### 1. 准备飞书 API 凭证

1. 访问 [飞书开放平台](https://open.feishu.cn/)
2. 创建或选择一个应用
3. 获取以下信息：
   - **App ID**: 应用的唯一标识
   - **App Secret**: 应用密钥
   - **Table ID**: 多维表格的 ID（可从表格 URL 中获取）

### 2. 安装扩展

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 启用右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择本项目的根目录
6. 扩展应该会出现在列表中

### 3. 配置扩展

1. 点击 Chrome 工具栏中的扩展图标
2. 在弹窗中选择"配置"标签
3. 填写飞书 API 凭证：
   - App ID
   - App Secret
   - Table ID
4. 点击"保存配置"

## 使用方法

### 准备飞书表格

确保飞书多维表格包含以下字段：
- **小红书标题**: 发布的标题
- **小红书文案**: 发布的正文内容
- **小红书封面**: 封面图片 URL
- **主题**: 内容主题（用于添加标签）
- **状态**: 记录状态（"pending" 或 "待发布" 表示待发布）
- **定时时间**: 定时发布时间（可选）

### 发布内容

1. 打开扩展弹窗
2. 选择"发布"标签
3. 点击"开始发布"按钮
4. 扩展会：
   - 从飞书读取待发布内容
   - 逐条打开小红书创建页面
   - 自动填写标题、文案、图片
   - 点击发布按钮
   - 等待发布完成后关闭页面
   - 继续下一条（30 秒间隔）

### 监控发布

- **统计信息**: 显示待发布、已发布、失败数量
- **进度条**: 显示发布进度百分比
- **日志**: 实时显示发布日志
- **搜索**: 可搜索日志内容

### 控制发布

- **暂停**: 暂停当前发布，可稍后继续
- **停止**: 停止发布，清空队列
- **清空日志**: 删除所有日志记录

## 技术细节

### 飞书 API 集成

1. **获取 Token**: 使用 App ID 和 App Secret 获取 `tenant_access_token`
2. **读取表格**: 使用 token 读取多维表格的所有记录
3. **过滤记录**: 只处理状态为 "pending" 或 "待发布" 的记录

### 小红书自动化

1. **打开创建页面**: 在新标签页打开 `https://www.xiaohongshu.com/creation`
2. **填写内容**: 使用 content script 填写标题、文案、图片
3. **提交发布**: 点击发布按钮
4. **等待完成**: 检查成功提示或 URL 变化
5. **关闭页面**: 发布完成后关闭标签页

### 发布间隔

- 默认间隔: 30 秒
- 可在 `background.js` 中修改 `sleep(30000)` 的值

## 常见问题

### Q: 扩展无法读取飞书数据
**A**: 检查以下几点：
- 确认 App ID 和 App Secret 正确
- 确认 Table ID 正确
- 检查飞书应用是否有读取多维表格的权限
- 查看日志中的错误信息

### Q: 小红书发布失败
**A**: 可能的原因：
- 小红书页面加载不完全，增加等待时间
- 小红书 UI 结构变化，需要更新选择器
- 网络连接问题
- 小红书账号未登录

### Q: 如何修改发布间隔
**A**: 编辑 `background.js`，找到 `await sleep(30000);` 这一行，修改数字（单位：毫秒）

### Q: 如何添加更多字段支持
**A**: 编辑 `background.js` 中的 `fetchFromFeishu` 函数，在任务对象中添加新字段

## 调试

### 查看后台日志

1. 打开 `chrome://extensions/`
2. 找到"小红书自动发布助手"
3. 点击"Service Worker"查看后台日志

### 查看 Content Script 日志

1. 在小红书创建页面按 F12 打开开发者工具
2. 查看 Console 标签中的日志

### 启用详细日志

在 `background.js` 中添加 `console.log()` 语句，然后查看 Service Worker 日志

## 安全建议

1. **不要分享凭证**: 不要将 App Secret 分享给他人
2. **定期更新**: 定期检查飞书和小红书的 API 变化
3. **备份数据**: 在自动发布前备份飞书数据
4. **测试发布**: 先用测试账号验证发布流程

## 更新日志

### v1.0.0 (2024-12-16)
- 初始版本
- 支持从飞书读取数据
- 支持自动发布到小红书
- 支持暂停/继续/停止
- 实时日志和监控

## 许可证

MIT

## 支持

如有问题，请查看日志或联系开发者。
