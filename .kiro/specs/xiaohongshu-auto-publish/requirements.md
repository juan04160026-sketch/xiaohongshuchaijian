# 小红书自动发布插件 - 需求文档

## 介绍

小红书自动发布插件是一个后台自动化工具，用于从飞书多维表格中读取内容数据，并自动发布到小红书平台。该系统支持多账号管理、精确到分钟的定时发布、以及批量处理，同时不占用桌面空间、不抢占鼠标控制权。

## 词汇表

- **飞书多维表格**：飞书提供的数据管理工具，用于存储发布内容的元数据
- **小红书账号**：小红书平台上的用户账号，用于发布内容
- **发布任务**：一条待发布的内容记录，包含标题、文案、封面图片等信息
- **定时发布**：在指定的日期和时间自动发布内容
- **后台服务**：在系统后台运行的服务，不占用用户界面
- **批量处理**：同时处理多个发布任务
- **表格字段**：
  - 主题：内容的主题分类
  - 状态：发布任务的当前状态（待发布、已发布、失败等）
  - 小红书标题：发布到小红书的标题
  - 小红书文案：发布到小红书的正文内容
  - 小红书封面：发布到小红书的封面图片链接
  - 最少页数：内容的最少页数要求
  - 最多页数：内容的最多页数要求
  - 生成时间：内容生成的时间戳
  - 定时时间：指定的发布时间（精确到分钟）
  - 父记录：关联的父级记录 ID
  - 商品ID：关联的商品 ID

## 需求

### 需求 1：从飞书多维表格读取发布数据

**用户故事**：作为内容运营人员，我想从飞书多维表格中读取发布内容数据，以便自动发布到小红书。

#### 接受标准

1. WHEN 系统启动时 THEN 系统 SHALL 连接到飞书 API 并获取指定多维表格的所有记录
2. WHEN 多维表格包含新记录时 THEN 系统 SHALL 解析表格中的小红书标题、小红书文案、小红书封面、状态和商品ID字段
3. WHEN 表格数据包含必需字段缺失时 THEN 系统 SHALL 验证数据完整性并记录错误，跳过该记录
4. WHEN 用户配置飞书表格 ID 时 THEN 系统 SHALL 保存配置并验证表格可访问性

### 需求 2：支持多个小红书账号管理

**用户故事**：作为内容运营人员，我想管理多个小红书账号，以便能够从不同账号发布内容。

#### 接受标准

1. WHEN 系统初始化时 THEN 系统 SHALL 支持配置和存储多个小红书账号的登录凭证
2. WHEN 发布任务指定目标账号时 THEN 系统 SHALL 使用对应账号的凭证进行发布
3. WHEN 账号凭证过期时 THEN 系统 SHALL 提示用户重新授权
4. WHEN 用户添加新账号时 THEN 系统 SHALL 验证账号有效性并保存配置

### 需求 3：精确到分钟的定时发布

**用户故事**：作为内容运营人员，我想精确控制发布时间（精确到分钟），以便在最佳时段发布内容。

#### 接受标准

1. WHEN 发布任务包含发布时间时 THEN 系统 SHALL 在指定的日期和时间自动发布内容
2. WHEN 当前时间到达发布时间时 THEN 系统 SHALL 立即执行发布操作
3. WHEN 系统运行时发布时间已过期时 THEN 系统 SHALL 立即发布或标记为已过期
4. WHEN 多个任务在同一时间发布时 THEN 系统 SHALL 按顺序依次发布

### 需求 4：后台批量处理

**用户故事**：作为内容运营人员，我想在后台批量处理多个发布任务，以便提高工作效率。

#### 接受标准

1. WHEN 系统启动时 THEN 系统 SHALL 在后台持续监控待发布任务
2. WHEN 有多个任务待发布时 THEN 系统 SHALL 按优先级和时间顺序处理
3. WHEN 任务正在处理时 THEN 系统 SHALL 不占用桌面空间、不抢占鼠标控制权
4. WHEN 任务处理完成时 THEN 系统 SHALL 记录发布结果和时间戳

### 需求 5：发布内容到小红书

**用户故事**：作为内容运营人员，我想自动将文字和图片内容发布到小红书，以便减少手动操作。

#### 接受标准

1. WHEN 发布任务包含文字和图片时 THEN 系统 SHALL 将内容上传到小红书平台
2. WHEN 图片链接有效时 THEN 系统 SHALL 下载并上传图片到小红书
3. WHEN 发布成功时 THEN 系统 SHALL 记录发布的内容 ID 和链接
4. WHEN 发布失败时 THEN 系统 SHALL 记录错误信息并支持重试

### 需求 6：任务状态管理和日志记录

**用户故事**：作为系统管理员，我想查看任务执行状态和详细日志，以便监控系统运行情况。

#### 接受标准

1. WHEN 任务执行时 THEN 系统 SHALL 记录任务状态（待发布、处理中、已发布、失败）
2. WHEN 任务完成时 THEN 系统 SHALL 记录完成时间、发布链接和相关元数据
3. WHEN 发生错误时 THEN 系统 SHALL 记录详细的错误信息和堆栈跟踪
4. WHEN 用户查询日志时 THEN 系统 SHALL 提供可搜索和可过滤的日志界面

### 需求 7：发布时间管理

**用户故事**：作为内容运营人员，我想能够指定精确的发布时间，以便在最佳时段发布内容。

#### 接受标准

1. WHEN 表格记录包含定时时间字段时 THEN 系统 SHALL 在指定的日期和时间自动发布内容
2. WHEN 定时时间已过期时 THEN 系统 SHALL 立即发布或标记为已过期，由用户配置决定
3. WHEN 表格中的状态字段为"待发布"且定时时间有效时 THEN 系统 SHALL 将该记录加入发布队列
4. WHEN 系统运行时发现多个任务在同一时间发布时 THEN 系统 SHALL 按顺序依次发布

### 需求 8：发布间隔控制

**用户故事**：作为内容运营人员，我想控制发布间隔时间，以便避免频繁发布导致账号限制。

#### 接受标准

1. WHEN 用户配置发布间隔时 THEN 系统 SHALL 在两次发布之间等待指定的秒数
2. WHEN 发布间隔设置生效时 THEN 系统 SHALL 按照间隔时间依次发布任务
3. WHEN 用户修改发布间隔时 THEN 系统 SHALL 立即应用新的间隔设置
4. WHEN 系统发布任务时 THEN 系统 SHALL 记录实际的发布间隔时间

### 需求 9：发布监控和控制

**用户故事**：作为内容运营人员，我想实时监控发布进度并能够暂停发布，以便灵活控制发布过程。

#### 接受标准

1. WHEN 系统发布任务时 THEN 系统 SHALL 显示发布进度（已发布数/总数）和百分比
2. WHEN 任务执行时 THEN 系统 SHALL 实时显示发布状态日志（时间戳、操作、结果）
3. WHEN 用户点击暂停按钮时 THEN 系统 SHALL 暂停当前发布任务并保存状态
4. WHEN 用户点击继续按钮时 THEN 系统 SHALL 从暂停位置继续发布剩余任务

### 需求 10：笔记列表展示

**用户故事**：作为内容运营人员，我想查看待发布的笔记列表，以便了解发布队列中的内容。

#### 接受标准

1. WHEN 系统加载待发布任务时 THEN 系统 SHALL 显示笔记列表，包含标题、描述等信息
2. WHEN 用户查看笔记列表时 THEN 系统 SHALL 显示每条笔记的发布状态
3. WHEN 笔记发布完成时 THEN 系统 SHALL 更新列表中的状态为已发布
4. WHEN 笔记发布失败时 THEN 系统 SHALL 在列表中标记失败状态并显示错误原因

### 需求 11：系统配置和初始化

**用户故事**：作为系统管理员，我想配置系统参数（飞书 API、小红书账号等），以便系统能够正常运行。

#### 接受标准

1. WHEN 系统首次启动时 THEN 系统 SHALL 提示用户配置飞书 API 密钥和表格 ID
2. WHEN 用户配置小红书账号时 THEN 系统 SHALL 验证凭证并保存加密配置
3. WHEN 配置保存时 THEN 系统 SHALL 将配置持久化到本地存储
4. WHEN 用户修改配置时 THEN 系统 SHALL 验证新配置的有效性
