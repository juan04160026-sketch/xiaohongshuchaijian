# 小红书自动发布助手 - 故障排除指南

## 常见问题和解决方案

### 1. 扩展无法加载

**症状**: 在 `chrome://extensions/` 中看不到扩展

**解决方案**:
1. 确保已启用"开发者模式"（右上角开关）
2. 检查项目目录中是否存在 `manifest.json`
3. 尝试重新加载扩展：
   - 点击扩展卡片上的刷新按钮
   - 或者删除后重新加载
4. 查看错误信息：
   - 点击"错误"链接查看详细错误
   - 常见错误：manifest 格式错误、文件缺失

### 2. 弹窗无法打开

**症状**: 点击扩展图标没有反应或弹窗显示空白

**解决方案**:
1. 检查 `popup.html` 是否存在且格式正确
2. 检查 `popup.js` 和 `popup.css` 是否被正确引用
3. 打开开发者工具查看错误：
   - 右键点击扩展图标 → 检查弹窗
   - 查看 Console 标签中的错误
4. 尝试重新加载扩展

### 3. 配置无法保存

**症状**: 点击"保存配置"后没有反应或显示错误

**解决方案**:
1. 检查输入框是否为空
2. 检查浏览器是否允许扩展使用存储空间
3. 打开开发者工具查看错误：
   - 右键点击扩展图标 → 检查弹窗
   - 查看 Console 标签
4. 尝试清除浏览器缓存后重试

### 4. 无法读取飞书数据

**症状**: 日志显示"读取飞书数据失败"或"获取飞书 token 失败"

**解决方案**:

#### 检查 API 凭证
1. 确认 App ID 和 App Secret 正确
   - 访问 [飞书开放平台](https://open.feishu.cn/)
   - 选择应用 → 凭证与基础信息
   - 复制 App ID 和 App Secret
2. 确认 Table ID 正确
   - 打开飞书多维表格
   - 从 URL 中提取 Table ID
   - 格式通常为：`https://feishu.cn/base/...?table=tblXXXXXXXX`

#### 检查权限
1. 确保应用有以下权限：
   - `bitable:app:readonly` - 读取多维表格
   - `bitable:table:readonly` - 读取表格
   - `bitable:record:readonly` - 读取记录
2. 在飞书开放平台中添加权限：
   - 应用 → 权限管理
   - 搜索并添加上述权限
   - 重新发布应用

#### 检查网络
1. 确保网络连接正常
2. 尝试在浏览器中直接访问飞书 API：
   ```
   https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal
   ```
3. 如果无法访问，可能是网络或防火墙问题

### 5. 小红书发布失败

**症状**: 日志显示"发布失败"或"找不到发布按钮"

**解决方案**:

#### 检查小红书登录状态
1. 手动打开 `https://www.xiaohongshu.com/creation`
2. 确保已登录小红书账号
3. 确保能看到编辑器界面

#### 检查页面加载
1. 增加等待时间：
   - 编辑 `background.js`
   - 找到 `await sleep(3000);` 这一行
   - 改为 `await sleep(5000);` 或更长
2. 检查小红书是否有加载动画或加载指示

#### 检查 UI 选择器
1. 小红书 UI 可能已更新，选择器失效
2. 手动检查元素：
   - 打开小红书创建页面
   - 按 F12 打开开发者工具
   - 检查标题输入框、文案编辑器、发布按钮的选择器
3. 更新 `content.js` 中的选择器：
   ```javascript
   // 查找标题输入框
   const titleInput = document.querySelector('input[placeholder*="标题"]');
   // 如果找不到，尝试其他选择器
   ```

#### 检查图片上传
1. 如果只是图片上传失败，其他内容可能已发布
2. 检查图片 URL 是否有效：
   - 在浏览器中打开图片 URL
   - 确保能正常加载
3. 尝试使用其他图片 URL 测试

### 6. 发布过程中扩展崩溃

**症状**: 发布过程中扩展停止响应或消失

**解决方案**:
1. 检查浏览器控制台是否有错误：
   - 打开 `chrome://extensions/`
   - 找到扩展 → 点击"Service Worker"
   - 查看 Console 标签
2. 检查是否有内存泄漏：
   - 监控内存占用
   - 如果持续增长，可能有内存泄漏
3. 尝试减少并发发布数量：
   - 编辑 `background.js`
   - 增加发布间隔时间
4. 重新加载扩展

### 7. 日志显示乱码

**症状**: 日志中显示乱码或特殊字符

**解决方案**:
1. 检查字符编码：
   - 确保文件使用 UTF-8 编码
   - 在编辑器中设置编码为 UTF-8
2. 检查 HTML 文件的字符集声明：
   ```html
   <meta charset="UTF-8">
   ```
3. 清除浏览器缓存后重试

### 8. 发布间隔不准确

**症状**: 发布间隔不是 30 秒

**解决方案**:
1. 检查网络延迟
   - 发布间隔是从上一条发布完成后开始计时
   - 如果网络慢，实际间隔会更长
2. 修改发布间隔：
   - 编辑 `background.js`
   - 找到 `await sleep(30000);`
   - 修改数字（单位：毫秒）
   - 例如：`await sleep(60000);` 表示 60 秒

### 9. 无法暂停或停止发布

**症状**: 点击暂停/停止按钮没有反应

**解决方案**:
1. 检查后台服务是否运行：
   - 打开 `chrome://extensions/`
   - 找到扩展 → 点击"Service Worker"
   - 查看是否有错误
2. 尝试重新加载扩展
3. 检查浏览器控制台是否有错误

### 10. 发布后内容不显示

**症状**: 发布成功但小红书上看不到内容

**解决方案**:
1. 检查小红书账号是否正确
   - 确保登录的是目标账号
2. 检查内容是否被审核
   - 小红书可能对新发布的内容进行审核
   - 等待审核完成
3. 检查内容是否违规
   - 查看小红书账号的"草稿"或"已发布"
   - 如果内容被删除，可能违反了社区规则
4. 手动发布测试
   - 手动在小红书上发布一条内容
   - 确认账号和发布功能正常

## 调试技巧

### 启用详细日志

在 `background.js` 中添加 `console.log()` 语句：

```javascript
// 在关键位置添加日志
console.log('开始发布:', task);
console.log('飞书响应:', response);
console.log('发布结果:', result);
```

然后查看 Service Worker 日志。

### 使用浏览器开发者工具

1. **查看 Service Worker 日志**:
   - 打开 `chrome://extensions/`
   - 找到扩展 → 点击"Service Worker"
   - 查看 Console 标签

2. **查看弹窗日志**:
   - 右键点击扩展图标
   - 选择"检查弹窗"
   - 查看 Console 标签

3. **查看 Content Script 日志**:
   - 在小红书创建页面按 F12
   - 查看 Console 标签

### 测试 API 调用

在浏览器控制台中测试 API 调用：

```javascript
// 测试飞书 token 获取
fetch('https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    app_id: 'YOUR_APP_ID',
    app_secret: 'YOUR_APP_SECRET'
  })
}).then(r => r.json()).then(console.log);
```

## 性能优化

### 减少 API 调用
- 缓存飞书 token（当前已实现）
- 批量读取记录而不是逐条读取

### 优化发布流程
- 增加页面加载等待时间
- 使用更高效的 DOM 选择器
- 减少不必要的事件触发

### 减少内存占用
- 定期清理日志（当前限制为 100 条）
- 及时关闭不需要的标签页
- 避免在内存中存储大量数据

## 获取帮助

如果以上解决方案都不能解决问题，请：

1. **收集日志信息**:
   - 打开 Service Worker 日志
   - 打开弹窗日志
   - 打开 Content Script 日志
   - 截图或复制日志内容

2. **检查错误信息**:
   - 记录完整的错误信息
   - 记录发生错误时的操作步骤

3. **提供环境信息**:
   - Chrome 版本
   - 操作系统
   - 飞书版本
   - 小红书版本

4. **联系开发者**:
   - 提供上述所有信息
   - 描述问题现象
   - 提供复现步骤
